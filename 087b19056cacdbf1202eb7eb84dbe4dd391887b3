packages/matador/examples/config.ts
  428bd6839162a1cd 57-60,69,71-74,79,81-84,91,93-96,101
packages/matador/src/checkpoint/context.test.ts
  428bd6839162a1cd 24
packages/matador/src/core/fanout.test.ts
  428bd6839162a1cd 112,131,150-153,174,203,227-229,247-248,270-273,276-279,314,331,352,393,413,432-435,453-456,475-478,481-484,487,504-507,528-531,551,567-569,605,646-649,652-655,693,735,751,781,796-797,840,861-862,886,919,967,1008-1010,1039-1042,1075,1094,1117,1144,1165-1168,1187
packages/matador/src/core/matador.test.ts
  428bd6839162a1cd 47,65,94,111-112,132,151,172-173,192,216,243,269-271,297,327,347,368,400,419,442,465
packages/matador/src/schema/types.test.ts
  428bd6839162a1cd 39-43,67-81,107-126,159-173,193-202,221-228,247-251,259-268
packages/matador/src/pipeline/pipeline.test.ts
  428bd6839162a1cd 48-49,144-145,314-315,345-346,382-383,432-433,476-477,511-512,553-554,597-598,638-639,690-691,728-729,780-781,824-825,872-873,921-922,967-968,1009-1010,1043-1044,1106-1107,1151-1152,1310
packages/matador/test/integration/matador.integration.test.ts
  428bd6839162a1cd 75-78,80,121-124,127,129-132,135,137-140,143,184-187,189,192-195,197,242-245,250,284-287,291,329-332,337,372-375,380,429-432,438,481,519-522,526,528-531,535,575-578,585
packages/matador/src/schema/registry.ts
  428bd6839162a1cd 123
packages/matador/src/retry/standard-policy.test.ts
  428bd6839162a1cd 263
packages/matador/src/schema/registry.test.ts
  428bd6839162a1cd 33,42,52-53,64,84-85,97,106,121-122,139-140,149,158-161,175,192,207-208,222,231-232,246
packages/matador/src/pipeline/pipeline.ts
  428bd6839162a1cd 348
packages/matador/src/types/subscriber.ts
  428bd6839162a1cd 44-46,178,191,213,224,237,262-272,275-283,285,287-288,290-293,295,304
---
{
  "schema_version": "authorship/3.0.0",
  "git_ai_version": "1.0.22",
  "base_commit_sha": "087b19056cacdbf1202eb7eb84dbe4dd391887b3",
  "prompts": {
    "428bd6839162a1cd": {
      "agent_id": {
        "tool": "claude",
        "id": "89bc9045-a4cd-4117-b01f-da4f8334325a",
        "model": "claude-opus-4-5-20251101"
      },
      "human_author": "Zachary Davison <zachary.davison@meetsmore.com>",
      "messages": [
        {
          "type": "user",
          "text": "'description' should be a required property for subscribers.",
          "timestamp": "2025-12-11T16:31:57.516Z"
        },
        {
          "type": "assistant",
          "text": "I'll make the `description` property required for subscribers. Let me first find the Subscriber type definition.",
          "timestamp": "2025-12-11T16:32:02.630Z"
        },
        {
          "type": "tool_use",
          "name": "Grep",
          "input": {
            "path": "/home/z/Desktop/work/matador",
            "pattern": "type Subscriber|interface Subscriber"
          },
          "timestamp": "2025-12-11T16:32:03.544Z"
        },
        {
          "type": "user",
          "text": "Found 4 files\nREADME.md\npackages/matador/src/types/subscriber.ts\npackages/matador/src/checkpoint/types.ts\ndocs/plans/resumable-subscribers.md",
          "timestamp": "2025-12-11T16:32:03.804Z"
        },
        {
          "type": "tool_use",
          "name": "Read",
          "input": {
            "file_path": "/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts"
          },
          "timestamp": "2025-12-11T16:32:06.754Z"
        },
        {
          "type": "user",
          "text": "     1â†’import type { SubscriberContext } from '../checkpoint/index.js';\n     2â†’import type { Idempotency, Importance } from './common.js';\n     3â†’import type { Envelope } from './envelope.js';\n     4â†’import type { MatadorEvent } from './event.js';\n     5â†’\n     6â†’/**\n     7â†’ * Helper type to get the envelope type for a subscriber callback.\n     8â†’ * Extracts the data type from a MatadorEvent and wraps it in an Envelope.\n     9â†’ *\n    10â†’ * @example\n    11â†’ * async callback(envelope: EnvelopeOf<MyEvent>) {\n    12â†’ *   console.log(envelope.data.someField); // Type-safe access\n    13â†’ * }\n    14â†’ */\n    15â†’export type EnvelopeOf<T extends MatadorEvent> = Envelope<T['data']>;\n    16â†’\n    17â†’/**\n    18â†’ * Callback function executed when an event is received (standard subscribers).\n    19â†’ * Receives the full envelope containing id, data, and docket.\n    20â†’ */\n    21â†’export type StandardCallback<T = unknown> = (\n    22â†’  envelope: Envelope<T>,\n    23â†’) => Promise<void> | void;\n    24â†’\n    25â†’/**\n    26â†’ * Callback function for resumable subscribers.\n    27â†’ * Receives the envelope and a SubscriberContext with io() for checkpointed operations.\n    28â†’ */\n    29â†’export type ResumableCallback<T = unknown> = (\n    30â†’  envelope: Envelope<T>,\n    31â†’  context: SubscriberContext,\n    32â†’) => Promise<void> | void;\n    33â†’\n    34â†’/**\n    35â†’ * Callback function executed when an event is received.\n    36â†’ * @deprecated Use StandardCallback or ResumableCallback instead.\n    37â†’ */\n    38â†’export type SubscriberCallback<T = unknown> = StandardCallback<T>;\n    39â†’\n    40â†’/**\n    41â†’ * Base configuration options shared by all subscriber types.\n    42â†’ */\n    43â†’export interface BaseSubscriberOptions {\n    44â†’  /** Route this subscriber's events to a specific queue */\n    45â†’  readonly targetQueue?: string | undefined;\n    46â†’\n    47â†’  /** Importance level for monitoring and alerting */\n    48â†’  readonly importance?: Importance | undefined;\n    49â†’\n    50â†’  /** Feature flag function to conditionally enable/disable the subscriber */\n    51â†’  readonly enabled?: (() => boolean | Promise<boolean>) | undefined;\n    52â†’}\n    53â†’\n    54â†’/**\n    55â†’ * Options for standard (non-resumable) subscribers.\n    56â†’ */\n    57â†’export interface StandardSubscriberOptions extends BaseSubscriberOptions {\n    58â†’  /** Idempotency declaration for retry handling (non-resumable) */\n    59â†’  readonly idempotent?: 'yes' | 'no' | 'unknown' | undefined;\n    60â†’}\n    61â†’\n    62â†’/**\n    63â†’ * Options for resumable subscribers that use io() for checkpointed operations.\n    64â†’ */\n    65â†’export interface ResumableSubscriberOptions extends BaseSubscriberOptions {\n    66â†’  /** Must be 'resumable' to enable checkpoint-based idempotency */\n    67â†’  readonly idempotent: 'resumable';\n    68â†’}\n    69â†’\n    70â†’/**\n    71â†’ * Configuration options for a subscriber.\n    72â†’ * Discriminated union based on idempotent value.\n    73â†’ */\n    74â†’export type SubscriberOptions =\n    75â†’  | StandardSubscriberOptions\n    76â†’  | ResumableSubscriberOptions;\n    77â†’\n    78â†’/**\n    79â†’ * Standard subscriber definition with standard callback.\n    80â†’ */\n    81â†’export interface StandardSubscriber<T extends MatadorEvent>\n    82â†’  extends StandardSubscriberOptions {\n    83â†’  /** Human-readable name for the subscriber */\n    84â†’  readonly name: string;\n    85â†’\n    86â†’  /** Callback function to execute when event is received */\n    87â†’  readonly callback: StandardCallback<T['data']>;\n    88â†’}\n    89â†’\n    90â†’/**\n    91â†’ * Resumable subscriber definition with resumable callback.\n    92â†’ */\n    93â†’export interface ResumableSubscriber<T extends MatadorEvent>\n    94â†’  extends ResumableSubscriberOptions {\n    95â†’  /** Human-readable name for the subscriber */\n    96â†’  readonly name: string;\n    97â†’\n    98â†’  /** Callback function with SubscriberContext for checkpointed operations */\n    99â†’  readonly callback: ResumableCallback<T['data']>;\n   100â†’}\n   101â†’\n   102â†’/**\n   103â†’ * Full subscriber definition with callback (either standard or resumable).\n   104â†’ */\n   105â†’export type Subscriber<T extends MatadorEvent> =\n   106â†’  | StandardSubscriber<T>\n   107â†’  | ResumableSubscriber<T>;\n   108â†’\n   109â†’/**\n   110â†’ * Subscriber stub for multi-codebase scenarios where subscriber implementation\n   111â†’ * is in a remote service. Declares the subscriber contract without providing\n   112â†’ * the callback.\n   113â†’ */\n   114â†’export interface SubscriberStub extends StandardSubscriberOptions {\n   115â†’  /** Human-readable name for the subscriber */\n   116â†’  readonly name: string;\n   117â†’\n   118â†’  /** Indicates this is a stub without implementation */\n   119â†’  readonly isStub: true;\n   120â†’}\n   121â†’\n   122â†’/**\n   123â†’ * Union type for any subscriber definition (full or stub).\n   124â†’ * This is the type-erased version for use in collections and schema.\n   125â†’ * Uses `any` because Subscriber<T> is contravariant in T (callback parameter),\n   126â†’ * making it impossible to assign Subscriber<SpecificEvent> to Subscriber<MatadorEvent<unknown>>.\n   127â†’ */\n   128â†’// biome-ignore lint/suspicious/noExplicitAny: Required for variance compatibility in heterogeneous collections\n   129â†’export type AnySubscriber = Subscriber<MatadorEvent<any>> | SubscriberStub;\n   130â†’\n   131â†’/**\n   132â†’ * Type guard to check if a subscriber is a stub.\n   133â†’ */\n   134â†’export function isSubscriberStub(\n   135â†’  subscriber: AnySubscriber,\n   136â†’): subscriber is SubscriberStub {\n   137â†’  return 'isStub' in subscriber && subscriber.isStub === true;\n   138â†’}\n   139â†’\n   140â†’/**\n   141â†’ * Type guard to check if a subscriber has a callback implementation.\n   142â†’ */\n   143â†’export function isSubscriber(\n   144â†’  subscriber: AnySubscriber,\n   145â†’  // biome-ignore lint/suspicious/noExplicitAny: Required for variance compatibility\n   146â†’): subscriber is Subscriber<MatadorEvent<any>> {\n   147â†’  return 'callback' in subscriber && typeof subscriber.callback === 'function';\n   148â†’}\n   149â†’\n   150â†’/**\n   151â†’ * Type guard to check if a subscriber is resumable.\n   152â†’ */\n   153â†’export function isResumableSubscriber(\n   154â†’  subscriber: AnySubscriber,\n   155â†’  // biome-ignore lint/suspicious/noExplicitAny: Required for variance compatibility\n   156â†’): subscriber is ResumableSubscriber<MatadorEvent<any>> {\n   157â†’  return isSubscriber(subscriber) && subscriber.idempotent === 'resumable';\n   158â†’}\n   159â†’\n   160â†’/**\n   161â†’ * Type guard to check if a subscriber is a standard (non-resumable) subscriber.\n   162â†’ */\n   163â†’export function isStandardSubscriber(\n   164â†’  subscriber: AnySubscriber,\n   165â†’  // biome-ignore lint/suspicious/noExplicitAny: Required for variance compatibility\n   166â†’): subscriber is StandardSubscriber<MatadorEvent<any>> {\n   167â†’  return isSubscriber(subscriber) && subscriber.idempotent !== 'resumable';\n   168â†’}\n   169â†’\n   170â†’/**\n   171â†’ * Input options for createSubscriber with standard callback.\n   172â†’ */\n   173â†’export interface CreateStandardSubscriberInput<T extends MatadorEvent> {\n   174â†’  readonly name: string;\n   175â†’  readonly callback: StandardCallback<T['data']>;\n   176â†’  readonly idempotent?: 'yes' | 'no' | 'unknown' | undefined;\n   177â†’  readonly importance?: Importance | undefined;\n   178â†’  readonly targetQueue?: string | undefined;\n   179â†’  readonly enabled?: (() => boolean | Promise<boolean>) | undefined;\n   180â†’}\n   181â†’\n   182â†’/**\n   183â†’ * Input options for createSubscriber with resumable callback.\n   184â†’ */\n   185â†’export interface CreateResumableSubscriberInput<T extends MatadorEvent> {\n   186â†’  readonly name: string;\n   187â†’  readonly callback: ResumableCallback<T['data']>;\n   188â†’  readonly idempotent: 'resumable';\n   189â†’  readonly importance?: Importance | undefined;\n   190â†’  readonly targetQueue?: string | undefined;\n   191â†’  readonly enabled?: (() => boolean | Promise<boolean>) | undefined;\n   192â†’}\n   193â†’\n   194â†’/**\n   195â†’ * Input options for createSubscriber (discriminated union).\n   196â†’ */\n   197â†’export type CreateSubscriberInput<T extends MatadorEvent> =\n   198â†’  | CreateStandardSubscriberInput<T>\n   199â†’  | CreateResumableSubscriberInput<T>;\n   200â†’\n   201â†’/**\n   202â†’ * Creates a subscriber definition.\n   203â†’ *\n   204â†’ * @example Standard subscriber\n   205â†’ * ```typescript\n   206â†’ * const subscriber = createSubscriber<MyEvent>({\n   207â†’ *   name: 'my-subscriber',\n   208â†’ *   callback: async (envelope) => {\n   209â†’ *     console.log(envelope.data);\n   210â†’ *   },\n   211â†’ * });\n   212â†’ * ```\n   213â†’ *\n   214â†’ * @example Resumable subscriber with io()\n   215â†’ * ```typescript\n   216â†’ * const subscriber = createSubscriber<MyEvent>({\n   217â†’ *   name: 'my-resumable-subscriber',\n   218â†’ *   idempotent: 'resumable',\n   219â†’ *   callback: async (envelope, { io }) => {\n   220â†’ *     await io('step-1', () => doSomething());\n   221â†’ *   },\n   222â†’ * });\n   223â†’ * ```\n   224â†’ */\n   225â†’export function createSubscriber<T extends MatadorEvent>(\n   226â†’  input: CreateSubscriberInput<T>,\n   227â†’): Subscriber<T>;\n   228â†’\n   229â†’/**\n   230â†’ * @deprecated Use object-based API instead: createSubscriber({ name, callback, ...options })\n   231â†’ */\n   232â†’export function createSubscriber<T extends MatadorEvent>(\n   233â†’  name: string,\n   234â†’  callback: StandardCallback<T['data']>,\n   235â†’  options?: StandardSubscriberOptions,\n   236â†’): StandardSubscriber<T>;\n   237â†’\n   238â†’export function createSubscriber<T extends MatadorEvent>(\n   239â†’  inputOrName: CreateSubscriberInput<T> | string,\n   240â†’  callback?: StandardCallback<T['data']>,\n   241â†’  options?: StandardSubscriberOptions,\n   242â†’): Subscriber<T> {\n   243â†’  // Legacy API: createSubscriber(name, callback, options)\n   244â†’  if (typeof inputOrName === 'string') {\n   245â†’    const opts = options ?? {};\n   246â†’    return {\n   247â†’      name: inputOrName,\n   248â†’      callback: callback!,\n   249â†’      idempotent: opts.idempotent ?? 'unknown',\n   250â†’      importance: opts.importance ?? 'should-investigate',\n   251â†’      ...(opts.targetQueue !== undefined && {\n   252â†’        targetQueue: opts.targetQueue,\n   253â†’      }),\n   254â†’      ...(opts.enabled !== undefined && { enabled: opts.enabled }),\n   255â†’    } as StandardSubscriber<T>;\n   256â†’  }\n   257â†’\n   258â†’  // New API: createSubscriber({ name, callback, ... })\n   259â†’  const input = inputOrName;\n   260â†’  const base = {\n   261â†’    name: input.name,\n   262â†’    callback: input.callback,\n   263â†’    importance: input.importance ?? 'should-investigate',\n   264â†’    ...(input.targetQueue !== undefined && {\n   265â†’      targetQueue: input.targetQueue,\n   266â†’    }),\n   267â†’    ...(input.enabled !== undefined && { enabled: input.enabled }),\n   268â†’  };\n   269â†’\n   270â†’  if (input.idempotent === 'resumable') {\n   271â†’    return {\n   272â†’      ...base,\n   273â†’      idempotent: 'resumable',\n   274â†’      callback: input.callback,\n   275â†’    } as ResumableSubscriber<T>;\n   276â†’  }\n   277â†’\n   278â†’  return {\n   279â†’    ...base,\n   280â†’    idempotent: input.idempotent ?? 'unknown',\n   281â†’    callback: input.callback,\n   282â†’  } as StandardSubscriber<T>;\n   283â†’}\n   284â†’\n   285â†’/**\n   286â†’ * Creates a subscriber stub for remote implementations.\n   287â†’ */\n   288â†’export function createSubscriberStub(\n   289â†’  name: string,\n   290â†’  options: StandardSubscriberOptions = {},\n   291â†’): SubscriberStub {\n   292â†’  return {\n   293â†’    name,\n   294â†’    isStub: true,\n   295â†’    idempotent: options.idempotent ?? 'unknown',\n   296â†’    importance: options.importance ?? 'should-investigate',\n   297â†’    ...(options.targetQueue !== undefined && {\n   298â†’      targetQueue: options.targetQueue,\n   299â†’    }),\n   300â†’    ...(options.enabled !== undefined && { enabled: options.enabled }),\n   301â†’  };\n   302â†’}\n   303â†’\n   304â†’/**\n   305â†’ * Definition interface used by the pipeline (excludes event class reference).\n   306â†’ */\n   307â†’export interface SubscriberDefinition {\n   308â†’  readonly name: string;\n   309â†’  readonly idempotent: Idempotency;\n   310â†’  readonly importance: Importance;\n   311â†’  readonly targetQueue?: string | undefined;\n   312â†’}\n   313â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n",
          "timestamp": "2025-12-11T16:32:06.828Z"
        },
        {
          "type": "assistant",
          "text": "I can see the structure. I need to add `description` as a required property to:\n1. `BaseSubscriberOptions` (make it required)\n2. `StandardSubscriber` and `ResumableSubscriber` interfaces\n3. `SubscriberStub` interface\n4. `CreateStandardSubscriberInput` and `CreateResumableSubscriberInput`\n5. `SubscriberDefinition`\n6. Update `createSubscriber` and `createSubscriberStub` functions\n\nLet me also check if there are existing usages I need to update:",
          "timestamp": "2025-12-11T16:32:11.840Z"
        },
        {
          "type": "tool_use",
          "name": "Grep",
          "input": {
            "output_mode": "files_with_matches",
            "path": "/home/z/Desktop/work/matador",
            "pattern": "createSubscriber"
          },
          "timestamp": "2025-12-11T16:32:12.813Z"
        },
        {
          "type": "user",
          "text": "Found 12 files\npackages/matador/src/pipeline/pipeline.test.ts\npackages/matador/src/types/subscriber.ts\ndocs/plans/resumable-subscribers.md\npackages/matador/src/types/index.ts\npackages/matador/src/index.ts\npackages/matador/src/core/fanout.test.ts\npackages/matador/src/schema/types.test.ts\npackages/matador/src/schema/types.ts\npackages/matador/src/schema/registry.test.ts\npackages/matador/test/integration/matador.integration.test.ts\npackages/matador/src/core/matador.test.ts\npackages/matador/examples/config.ts",
          "timestamp": "2025-12-11T16:32:12.958Z"
        },
        {
          "type": "tool_use",
          "name": "Grep",
          "input": {
            "output_mode": "files_with_matches",
            "path": "/home/z/Desktop/work/matador",
            "pattern": "createSubscriberStub"
          },
          "timestamp": "2025-12-11T16:32:17.530Z"
        },
        {
          "type": "user",
          "text": "Found 5 files\npackages/matador/src/types/subscriber.ts\npackages/matador/src/types/index.ts\npackages/matador/src/index.ts\npackages/matador/src/core/fanout.test.ts\npackages/matador/src/schema/types.test.ts",
          "timestamp": "2025-12-11T16:32:17.717Z"
        },
        {
          "type": "assistant",
          "text": "Let me read the test files and examples to understand the usage patterns:",
          "timestamp": "2025-12-11T16:32:20.902Z"
        },
        {
          "type": "tool_use",
          "name": "Grep",
          "input": {
            "-A": 5,
            "output_mode": "content",
            "path": "/home/z/Desktop/work/matador",
            "pattern": "createSubscriber\\("
          },
          "timestamp": "2025-12-11T16:32:21.751Z"
        },
        {
          "type": "user",
          "text": "packages/matador/src/types/subscriber.ts:230: * @deprecated Use object-based API instead: createSubscriber({ name, callback, ...options })\n/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts-231- */\n/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts-232-export function createSubscriber<T extends MatadorEvent>(\npackages/matador/src/types/subscriber.ts-233-  name: string,\npackages/matador/src/types/subscriber.ts-234-  callback: StandardCallback<T['data']>,\npackages/matador/src/types/subscriber.ts-235-  options?: StandardSubscriberOptions,\n--\npackages/matador/src/types/subscriber.ts:243:  // Legacy API: createSubscriber(name, callback, options)\n/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts-244-  if (typeof inputOrName === 'string') {\n/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts-245-    const opts = options ?? {};\n/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts-246-    return {\npackages/matador/src/types/subscriber.ts-247-      name: inputOrName,\npackages/matador/src/types/subscriber.ts-248-      callback: callback!,\n--\npackages/matador/src/types/subscriber.ts:258:  // New API: createSubscriber({ name, callback, ... })\n/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts-259-  const input = inputOrName;\n/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts-260-  const base = {\npackages/matador/src/types/subscriber.ts-261-    name: input.name,\npackages/matador/src/types/subscriber.ts-262-    callback: input.callback,\npackages/matador/src/types/subscriber.ts-263-    importance: input.importance ?? 'should-investigate',\n--\npackages/matador/src/core/matador.test.ts:47:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-48-\npackages/matador/src/core/matador.test.ts-49-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-50-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-51-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-52-\n--\npackages/matador/src/core/matador.test.ts:65:      const subscriber = createSubscriber('handle-user', async () => {});\npackages/matador/src/core/matador.test.ts-66-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-67-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-68-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-69-\npackages/matador/src/core/matador.test.ts-70-      const logs: string[] = [];\n--\npackages/matador/src/core/matador.test.ts:94:      const subscriber = createSubscriber('send-welcome-email', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-95-\npackages/matador/src/core/matador.test.ts-96-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-97-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-98-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-99-\n--\npackages/matador/src/core/matador.test.ts:111:      const userSub = createSubscriber('handle-user', async () => {});\npackages/matador/src/core/matador.test.ts:112:      const orderSub = createSubscriber('handle-order', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-113-\npackages/matador/src/core/matador.test.ts-114-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-115-        [UserCreatedEvent.key]: [UserCreatedEvent, [userSub]],\npackages/matador/src/core/matador.test.ts-116-        [OrderPlacedEvent.key]: [OrderPlacedEvent, [orderSub]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-117-      };\n--\npackages/matador/src/core/matador.test.ts:132:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-133-\npackages/matador/src/core/matador.test.ts-134-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-135-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-136-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-137-\n--\npackages/matador/src/core/matador.test.ts:151:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-152-\npackages/matador/src/core/matador.test.ts-153-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-154-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-155-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-156-\n--\npackages/matador/src/core/matador.test.ts:172:      const sub1 = createSubscriber('same-name', async () => {});\npackages/matador/src/core/matador.test.ts:173:      const sub2 = createSubscriber('same-name', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-174-\npackages/matador/src/core/matador.test.ts-175-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-176-        [UserCreatedEvent.key]: [UserCreatedEvent, [sub1, sub2]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-177-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-178-\n--\npackages/matador/src/core/matador.test.ts:192:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-193-\npackages/matador/src/core/matador.test.ts-194-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-195-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-196-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-197-\n--\npackages/matador/src/core/matador.test.ts:216:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-217-\npackages/matador/src/core/matador.test.ts-218-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-219-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-220-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-221-\n--\npackages/matador/src/core/matador.test.ts:243:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-244-\npackages/matador/src/core/matador.test.ts-245-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-246-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-247-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-248-\n--\npackages/matador/src/core/matador.test.ts:269:      const sub1 = createSubscriber('sub-1', async () => {});\npackages/matador/src/core/matador.test.ts:270:      const sub2 = createSubscriber('sub-2', async () => {});\npackages/matador/src/core/matador.test.ts:271:      const sub3 = createSubscriber('sub-3', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-272-\npackages/matador/src/core/matador.test.ts-273-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-274-        [UserCreatedEvent.key]: [UserCreatedEvent, [sub1, sub2, sub3]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-275-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-276-\n--\npackages/matador/src/core/matador.test.ts:297:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-298-\npackages/matador/src/core/matador.test.ts-299-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-300-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-301-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-302-\n--\npackages/matador/src/core/matador.test.ts:327:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-328-\npackages/matador/src/core/matador.test.ts-329-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-330-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-331-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-332-\n--\npackages/matador/src/core/matador.test.ts:347:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-348-\npackages/matador/src/core/matador.test.ts-349-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-350-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-351-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-352-\n--\npackages/matador/src/core/matador.test.ts:368:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-369-\npackages/matador/src/core/matador.test.ts-370-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-371-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-372-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-373-\n--\npackages/matador/src/core/matador.test.ts:400:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-401-\npackages/matador/src/core/matador.test.ts-402-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-403-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-404-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-405-\n--\npackages/matador/src/core/matador.test.ts:419:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-420-\npackages/matador/src/core/matador.test.ts-421-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-422-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-423-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-424-\n--\npackages/matador/src/core/matador.test.ts:442:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-443-\npackages/matador/src/core/matador.test.ts-444-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-445-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-446-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-447-\n--\npackages/matador/src/core/matador.test.ts:465:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-466-\npackages/matador/src/core/matador.test.ts-467-      const schema: MatadorSchema = {\npackages/matador/src/core/matador.test.ts-468-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-469-      };\n/home/z/Desktop/work/matador/packages/matador/src/core/matador.test.ts-470-\n--\npackages/matador/examples/config.ts:57:const sendWelcomeEmail = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-58-  'send-welcome-email',\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-59-  async ({ data, docket }) => {\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-60-    console.log(`  ðŸ“§ Sending welcome email to ${data.email}`);\npackages/matador/examples/config.ts-61-    console.log(`     User: ${data.name} (${data.userId})`);\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-62-    if (docket.correlationId) {\n--\npackages/matador/examples/config.ts:69:const trackUserAnalytics = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-70-  'track-user-analytics',\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-71-  async ({ data }) => {\npackages/matador/examples/config.ts-72-    console.log(`  ðŸ“Š Tracking analytics for new user: ${data.userId}`);\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-73-  },\npackages/matador/examples/config.ts-74-  { idempotent: 'yes', importance: 'can-ignore' },\n--\npackages/matador/examples/config.ts:77:const processOrder = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-78-  'process-order',\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-79-  async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-80-    console.log(`  ðŸ“¦ Processing order ${data.orderId}`);\npackages/matador/examples/config.ts-81-    console.log(`     Amount: $${data.amount.toFixed(2)}`);\npackages/matador/examples/config.ts-82-    console.log(`     Items: ${data.items.length} item(s)`);\n--\npackages/matador/examples/config.ts:87:const sendOrderConfirmation = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-88-  'send-order-confirmation',\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-89-  async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-90-    console.log(`  ðŸ“§ Sending order confirmation for ${data.orderId}`);\n/home/z/Desktop/work/matador/packages/matador/examples/config.ts-91-  },\npackages/matador/examples/config.ts-92-  { idempotent: 'yes', importance: 'should-investigate' },\n--\npackages/matador/test/integration/matador.integration.test.ts:75:      const subscriber = createSubscriber('process-user', async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-76-        processedUsers.push(data.userId);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-77-      });\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-78-\npackages/matador/test/integration/matador.integration.test.ts-79-      const schema: MatadorSchema = {\npackages/matador/test/integration/matador.integration.test.ts-80-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n--\npackages/matador/test/integration/matador.integration.test.ts:117:      const notifySub = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-118-        'send-notification',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-119-        async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-120-          notifications.push(data.userId);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-121-        },\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-122-      );\n--\npackages/matador/test/integration/matador.integration.test.ts:124:      const analyticsSub = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-125-        'track-analytics',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-126-        async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-127-          analytics.push(data.userId);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-128-        },\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-129-      );\n--\npackages/matador/test/integration/matador.integration.test.ts:131:      const emailSub = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-132-        'send-welcome-email',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-133-        async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-134-          emails.push(data.email);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-135-        },\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-136-      );\n--\npackages/matador/test/integration/matador.integration.test.ts:177:      const userSub = createSubscriber('process-user', async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-178-        users.push(data.userId);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-179-      });\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-180-\npackages/matador/test/integration/matador.integration.test.ts:181:      const orderSub = createSubscriber('process-order', async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-182-        orders.push(data.orderId);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-183-      });\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-184-\npackages/matador/test/integration/matador.integration.test.ts-185-      const schema: MatadorSchema = {\npackages/matador/test/integration/matador.integration.test.ts-186-        [UserCreatedEvent.key]: [UserCreatedEvent, [userSub]],\n--\npackages/matador/test/integration/matador.integration.test.ts:227:      const subscriber = createSubscriber('flaky-subscriber', async () => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-228-        attempts++;\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-229-        if (attempts < maxAttempts) {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-230-          throw new DoRetry('Temporary failure');\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-231-        }\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-232-      });\n--\npackages/matador/test/integration/matador.integration.test.ts:265:      const subscriber = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-266-        'permanent-fail-subscriber',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-267-        async () => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-268-          attempts++;\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-269-          throw new DontRetry('Permanent failure');\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-270-        },\n--\npackages/matador/test/integration/matador.integration.test.ts:309:      const subscriber = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-310-        'track-correlation',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-311-        async ({ docket }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-312-          if (docket.correlationId) {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-313-            correlationIds.push(docket.correlationId);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-314-          }\n--\npackages/matador/test/integration/matador.integration.test.ts:351:      const subscriber = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-352-        'capture-metadata',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-353-        async ({ docket }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-354-          if (docket.metadata) {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-355-            receivedMetadata.push(docket.metadata);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-356-          }\n--\npackages/matador/test/integration/matador.integration.test.ts:407:      const subscriber = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-408-        'slow-subscriber',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-409-        async ({ data }) => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-410-          processingStarted = true;\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-411-          // Simulate slow processing\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-412-          await new Promise((resolve) => setTimeout(resolve, 500));\n--\npackages/matador/test/integration/matador.integration.test.ts:458:      const subscriber = createSubscriber('test-subscriber', async () => {});\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-459-\npackages/matador/test/integration/matador.integration.test.ts-460-      const schema: MatadorSchema = {\npackages/matador/test/integration/matador.integration.test.ts-461-        [UserCreatedEvent.key]: [UserCreatedEvent, [subscriber]],\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-462-      };\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-463-\n--\npackages/matador/test/integration/matador.integration.test.ts:496:      const enabledSub = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-497-        'enabled-subscriber',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-498-        async ({ data }) => {\npackages/matador/test/integration/matador.integration.test.ts-499-          processed.push(`enabled:${data.userId}`);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-500-        },\npackages/matador/test/integration/matador.integration.test.ts-501-        { enabled: () => true },\n--\npackages/matador/test/integration/matador.integration.test.ts:504:      const disabledSub = createSubscriber(\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-505-        'disabled-subscriber',\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-506-        async ({ data }) => {\npackages/matador/test/integration/matador.integration.test.ts-507-          processed.push(`disabled:${data.userId}`);\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-508-        },\npackages/matador/test/integration/matador.integration.test.ts-509-        { enabled: () => false },\n--\npackages/matador/test/integration/matador.integration.test.ts:550:      const subscriber = createSubscriber('state-subscriber', async () => {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-551-        // Check state while processing\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-552-        const state = matador.getHandlersState();\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-553-        if (state.eventsBeingProcessed > 0) {\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-554-          wasNotIdle = true;\n/home/z/Desktop/work/matador/packages/matador/test/integration/matador.integration.test.ts-555-        }\n--\npackages/matador/src/core/fanout.test.ts:112:      const subscriber = createSubscriber('send-welcome-email', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-113-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-114-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-115-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-116-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-117-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:131:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-132-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-133-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-134-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-135-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-136-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:150:      const subscriber = createSubscriber('handle-user', async () => {}, {\npackages/matador/src/core/fanout.test.ts-151-        targetQueue: 'notifications',\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-152-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-153-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-154-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-155-\n--\npackages/matador/src/core/fanout.test.ts:171:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-172-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-173-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-174-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-175-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-176-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:200:      const subscriber = createSubscriber('order-handler', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-201-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-202-      schema.register(OrderPlacedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-203-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-204-      const event = new OrderPlacedEvent({\npackages/matador/src/core/fanout.test.ts-205-        orderId: 'ord_123',\n--\npackages/matador/src/core/fanout.test.ts:224:      const sub1 = createSubscriber('subscriber-1', async () => {});\npackages/matador/src/core/fanout.test.ts:225:      const sub2 = createSubscriber('subscriber-2', async () => {});\npackages/matador/src/core/fanout.test.ts:226:      const sub3 = createSubscriber('subscriber-3', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-227-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-228-      schema.register(UserCreatedEvent, [sub1, sub2, sub3]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-229-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-230-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-231-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:244:      const sub1 = createSubscriber('subscriber-1', async () => {});\npackages/matador/src/core/fanout.test.ts:245:      const sub2 = createSubscriber('subscriber-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-246-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-247-      schema.register(UserCreatedEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-248-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-249-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-250-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:267:      const sub1 = createSubscriber('subscriber-1', async () => {}, {\npackages/matador/src/core/fanout.test.ts-268-        targetQueue: 'queue-1',\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-269-      });\npackages/matador/src/core/fanout.test.ts:270:      const sub2 = createSubscriber('subscriber-2', async () => {}, {\npackages/matador/src/core/fanout.test.ts-271-        targetQueue: 'queue-2',\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-272-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-273-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-274-      schema.register(UserCreatedEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-275-\n--\npackages/matador/src/core/fanout.test.ts:305:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-306-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-307-      schema.register(UserCreatedEventWithMetadata, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-308-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-309-      const event = new UserCreatedEventWithMetadata(\npackages/matador/src/core/fanout.test.ts-310-        { userId: '123', email: 'test@example.com' },\n--\npackages/matador/src/core/fanout.test.ts:322:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-323-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-324-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-325-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-326-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-327-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:343:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-344-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-345-      schema.register(UserCreatedEventWithMetadata, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-346-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-347-      const event = new UserCreatedEventWithMetadata(\npackages/matador/src/core/fanout.test.ts-348-        { userId: '123', email: 'test@example.com' },\n--\npackages/matador/src/core/fanout.test.ts:384:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-385-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-386-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-387-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-388-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-389-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:404:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-405-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-406-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-407-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-408-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-409-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:423:      const subscriber = createSubscriber('handle-user', async () => {}, {\npackages/matador/src/core/fanout.test.ts-424-        enabled: () => true,\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-425-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-426-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-427-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-428-\n--\npackages/matador/src/core/fanout.test.ts:441:      const subscriber = createSubscriber('handle-user', async () => {}, {\npackages/matador/src/core/fanout.test.ts-442-        enabled: () => false,\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-443-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-444-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-445-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-446-\n--\npackages/matador/src/core/fanout.test.ts:460:      const sub1 = createSubscriber('enabled-sub', async () => {}, {\npackages/matador/src/core/fanout.test.ts-461-        enabled: () => true,\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-462-      });\npackages/matador/src/core/fanout.test.ts:463:      const sub2 = createSubscriber('disabled-sub', async () => {}, {\npackages/matador/src/core/fanout.test.ts-464-        enabled: () => false,\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-465-      });\npackages/matador/src/core/fanout.test.ts:466:      const sub3 = createSubscriber('always-enabled-sub', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-467-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-468-      schema.register(UserCreatedEvent, [sub1, sub2, sub3]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-469-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-470-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-471-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:483:      const subscriber = createSubscriber('handle-user', async () => {}, {\npackages/matador/src/core/fanout.test.ts-484-        enabled: async () => {\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-485-          await new Promise((resolve) => setTimeout(resolve, 10));\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-486-          return true;\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-487-        },\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-488-      });\n--\npackages/matador/src/core/fanout.test.ts:504:      const subscriber = createSubscriber('handle-user', async () => {}, {\npackages/matador/src/core/fanout.test.ts-505-        enabled: () => {\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-506-          throw new Error('Feature flag service down');\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-507-        },\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-508-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-509-\n--\npackages/matador/src/core/fanout.test.ts:524:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-525-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-526-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-527-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-528-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-529-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:576:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-577-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-578-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-579-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-580-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-581-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:617:      const sub1 = createSubscriber('subscriber-1', async () => {}, {\npackages/matador/src/core/fanout.test.ts-618-        targetQueue: 'queue-1',\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-619-      });\npackages/matador/src/core/fanout.test.ts:620:      const sub2 = createSubscriber('subscriber-2', async () => {}, {\npackages/matador/src/core/fanout.test.ts-621-        targetQueue: 'queue-2',\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-622-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-623-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-624-      schema.register(UserCreatedEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-625-\n--\npackages/matador/src/core/fanout.test.ts:658:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-659-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-660-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-661-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-662-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-663-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:700:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-701-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-702-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-703-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-704-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-705-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:716:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-717-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-718-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-719-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-720-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-721-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:746:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-747-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-748-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-749-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-750-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-751-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:761:      const sub1 = createSubscriber('subscriber-1', async () => {});\npackages/matador/src/core/fanout.test.ts:762:      const sub2 = createSubscriber('subscriber-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-763-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-764-      schema.register(UserCreatedEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-765-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-766-      let maxCount = 0;\npackages/matador/src/core/fanout.test.ts-767-      const counts: number[] = [];\n--\npackages/matador/src/core/fanout.test.ts:805:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-806-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-807-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-808-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-809-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-810-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:826:      const sub1 = createSubscriber('subscriber-1', async () => {});\npackages/matador/src/core/fanout.test.ts:827:      const sub2 = createSubscriber('subscriber-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-828-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-829-      schema.register(UserCreatedEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-830-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-831-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-832-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:851:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-852-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-853-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-854-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-855-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-856-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:884:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-885-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-886-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-887-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-888-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-889-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:932:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-933-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-934-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-935-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-936-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-937-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:973:      const sub1 = createSubscriber('subscriber-1', async () => {});\npackages/matador/src/core/fanout.test.ts:974:      const sub2 = createSubscriber('subscriber-2', async () => {});\npackages/matador/src/core/fanout.test.ts:975:      const sub3 = createSubscriber('subscriber-3', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-976-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-977-      schema.register(UserCreatedEvent, [sub1, sub2, sub3]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-978-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-979-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-980-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:1004:      const subscriber = createSubscriber('handle-user', async () => {}, {\npackages/matador/src/core/fanout.test.ts-1005-        enabled: () => false,\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1006-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1007-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1008-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1009-\n--\npackages/matador/src/core/fanout.test.ts:1037:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1038-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1039-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1040-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1041-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-1042-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:1056:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1057-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1058-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1059-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1060-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-1061-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:1079:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1080-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1081-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1082-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1083-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-1084-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:1106:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1107-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1108-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1109-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1110-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-1111-        userId: '123',\n--\npackages/matador/src/core/fanout.test.ts:1127:      const subscriber = createSubscriber('handle-user', async () => {}, {\npackages/matador/src/core/fanout.test.ts-1128-        importance: 'must-investigate',\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1129-      });\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1130-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1131-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1132-\n--\npackages/matador/src/core/fanout.test.ts:1146:      const subscriber = createSubscriber('handle-user', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1147-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1148-      schema.register(UserCreatedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1149-\n/home/z/Desktop/work/matador/packages/matador/src/core/fanout.test.ts-1150-      const event = new UserCreatedEvent({\npackages/matador/src/core/fanout.test.ts-1151-        userId: '123',\n--\npackages/matador/src/schema/registry.test.ts:33:      const subscriber = createSubscriber('test-subscriber', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-34-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-35-      registry.register(TestEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-36-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-37-      expect(registry.hasEvent('test.event')).toBe(true);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-38-      expect(registry.getSubscribers('test.event')).toHaveLength(1);\n--\npackages/matador/src/schema/registry.test.ts:42:      const subscriber = createSubscriber('test-subscriber', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-43-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-44-      registry.register(TestEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-45-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-46-      expect(() => registry.register(TestEvent, [subscriber])).toThrow(\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-47-        SchemaError,\n--\npackages/matador/src/schema/registry.test.ts:52:      const subscriber1 = createSubscriber('sub-1', async () => {});\npackages/matador/src/schema/registry.test.ts:53:      const subscriber2 = createSubscriber('sub-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-54-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-55-      registry.register(TestEvent, [subscriber1]);\npackages/matador/src/schema/registry.test.ts-56-      registry.register(TestEvent, [subscriber2], { override: true });\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-57-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-58-      const subscribers = registry.getSubscribers('test.event');\n--\npackages/matador/src/schema/registry.test.ts:64:      const subscriber = createSubscriber('test-subscriber', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-65-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-66-      registry.register(AliasedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-67-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-68-      expect(registry.hasEvent('user.created.v2')).toBe(true);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-69-      expect(registry.hasEvent('user.created')).toBe(true);\n--\npackages/matador/src/schema/registry.test.ts:84:      const sub1 = createSubscriber('sub-1', async () => {});\npackages/matador/src/schema/registry.test.ts:85:      const sub2 = createSubscriber('sub-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-86-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-87-      registry.register(AliasedEvent, [sub1]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-88-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-89-      expect(() => registry.register(EventWithSameAlias, [sub2])).toThrow(\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-90-        'Alias \"user.created\" is already registered',\n--\npackages/matador/src/schema/registry.test.ts:97:      const subscriber = createSubscriber('test-subscriber', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-98-      registry.register(TestEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-99-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-100-      const eventClass = registry.getEventClass('test.event');\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-101-      expect(eventClass).toBeDefined();\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-102-      expect(eventClass?.key).toBe('test.event');\n--\npackages/matador/src/schema/registry.test.ts:106:      const subscriber = createSubscriber('test-subscriber', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-107-      registry.register(AliasedEvent, [subscriber]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-108-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-109-      const eventClass = registry.getEventClass('user.created');\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-110-      expect(eventClass).toBeDefined();\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-111-      expect(eventClass?.key).toBe('user.created.v2');\n--\npackages/matador/src/schema/registry.test.ts:121:      const sub1 = createSubscriber('sub-1', async () => {});\npackages/matador/src/schema/registry.test.ts:122:      const sub2 = createSubscriber('sub-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-123-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-124-      registry.register(TestEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-125-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-126-      const subscribers = registry.getSubscribers('test.event');\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-127-      expect(subscribers).toHaveLength(2);\n--\npackages/matador/src/schema/registry.test.ts:139:      const sub1 = createSubscriber('sub-1', async () => {});\npackages/matador/src/schema/registry.test.ts:140:      const sub2 = createSubscriber('sub-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-141-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-142-      registry.register(TestEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-143-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-144-      const subscriber = registry.getSubscriber('test.event', 'sub-2');\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-145-      expect(subscriber?.name).toBe('sub-2');\n--\npackages/matador/src/schema/registry.test.ts:149:      const sub = createSubscriber('sub-1', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-150-      registry.register(TestEvent, [sub]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-151-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-152-      expect(registry.getSubscriber('test.event', 'unknown')).toBeUndefined();\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-153-    });\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-154-  });\n--\npackages/matador/src/schema/registry.test.ts:158:      const sub = createSubscriber('sub-1', async () => {}, {\npackages/matador/src/schema/registry.test.ts-159-        idempotent: 'yes',\npackages/matador/src/schema/registry.test.ts-160-        importance: 'must-investigate',\npackages/matador/src/schema/registry.test.ts-161-        targetQueue: 'custom-queue',\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-162-      });\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-163-\n--\npackages/matador/src/schema/registry.test.ts:188:      const sub = createSubscriber('sub-1', callback);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-189-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-190-      registry.register(TestEvent, [sub]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-191-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-192-      const executable = registry.getExecutableSubscriber(\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-193-        'test.event',\n--\npackages/matador/src/schema/registry.test.ts:203:      const sub1 = createSubscriber('sub-1', async () => {});\npackages/matador/src/schema/registry.test.ts:204:      const sub2 = createSubscriber('sub-2', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-205-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-206-      registry.register(TestEvent, [sub1]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-207-      registry.register(AliasedEvent, [sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-208-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-209-      const keys = registry.getEventKeys();\n--\npackages/matador/src/schema/registry.test.ts:218:      const sub = createSubscriber('sub-1', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-219-      registry.register(TestEvent, [sub]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-220-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-221-      const result = registry.validate();\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-222-      expect(result.valid).toBe(true);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-223-      expect(result.issues).toHaveLength(0);\n--\npackages/matador/src/schema/registry.test.ts:227:      const sub1 = createSubscriber('duplicate-name', async () => {});\npackages/matador/src/schema/registry.test.ts:228:      const sub2 = createSubscriber('duplicate-name', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-229-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-230-      registry.register(TestEvent, [sub1, sub2]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-231-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-232-      const result = registry.validate();\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-233-      expect(result.valid).toBe(false);\n--\npackages/matador/src/schema/registry.test.ts:242:      const sub = createSubscriber('sub-1', async () => {});\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-243-      registry.register(TestEvent, [sub]);\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-244-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-245-      registry.clear();\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-246-\n/home/z/Desktop/work/matador/packages/matador/src/schema/registry.test.ts-247-      expect(registry.hasEvent('test.event')).toBe(false);",
          "timestamp": "2025-12-11T16:32:21.856Z"
        },
        {
          "type": "assistant",
          "text": "There are many usages, primarily using the legacy API (3-arg form). I need to:\n\n1. Add `description` as required to the type definitions\n2. Update the `createSubscriber` function to require `description`\n3. Update all test files and examples to include descriptions\n\nLet me start by updating the type definitions:",
          "timestamp": "2025-12-11T16:32:26.345Z"
        },
        {
          "type": "tool_use",
          "name": "TodoWrite",
          "input": {
            "todos": [
              {
                "activeForm": "Updating subscriber types to require description",
                "content": "Update subscriber types to require description",
                "status": "in_progress"
              },
              {
                "activeForm": "Updating createSubscriber and createSubscriberStub functions",
                "content": "Update createSubscriber and createSubscriberStub functions",
                "status": "pending"
              },
              {
                "activeForm": "Updating test files with descriptions",
                "content": "Update test files with descriptions",
                "status": "pending"
              },
              {
                "activeForm": "Updating examples with descriptions",
                "content": "Update examples with descriptions",
                "status": "pending"
              },
              {
                "activeForm": "Running typecheck to verify changes",
                "content": "Run typecheck to verify changes",
                "status": "pending"
              }
            ]
          },
          "timestamp": "2025-12-11T16:32:29.059Z"
        },
        {
          "type": "user",
          "text": "Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable",
          "timestamp": "2025-12-11T16:32:29.112Z"
        },
        {
          "type": "tool_use",
          "name": "Edit",
          "input": {
            "file_path": "/home/z/Desktop/work/matador/packages/matador/src/types/subscriber.ts",
            "new_string": "/**\n * Base configuration options shared by all subscriber types.\n */\nexport interface BaseSubscriberOptions {\n  /** Human-readable description of what this subscriber does */\n  readonly description: string;\n\n  /** Route this subscriber's events to a specific queue */\n  readonly targetQueue?: string | undefined;\n\n  /** Importance level for monitoring and alerting */\n  readonly importance?: Importance | undefined;\n\n  /** Feature flag function to conditionally enable/disable the subscriber */\n  readonly enabled?: (() => boolean | Promise<boolean>) | undefined;\n}",
            "old_string": "/**\n * Base configuration options shared by all subscriber types.\n */\nexport interface BaseSubscriberOptions {\n  /** Route this subscriber's events to a specific queue */\n  readonly targetQueue?: string | undefined;\n\n  /** Importance level for monitoring and alerting */\n  readonly importance?: Importance | undefined;\n\n  /** Feature flag function to conditionally enable/disable the subscriber */\n  readonly enabled?: (() => boolean | Promise<boolean>) | undefined;\n}"
          },
          "timestamp": "2025-12-11T16:32:35.447Z"
        }
      ],
      "total_additions": 578,
      "total_deletions": 429,
      "accepted_lines": 407,
      "overriden_lines": 0
    }
  }
}
